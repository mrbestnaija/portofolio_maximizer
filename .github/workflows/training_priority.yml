name: Training Priority Cycle

on:
  schedule:
    - cron: "30 6 * * 6" # Saturdays 06:30 UTC
  workflow_dispatch:

jobs:
  training-priority:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run prioritized forecaster cycle (CI target)
        run: |
          python scripts/run_training_priority_cycle.py \
            --profile forecasters \
            --target ci \
            --continue-on-error \
            --output-json logs/automation/training_priority/ci_forecasters_${{ github.run_id }}.json

      - name: Run prioritized LLM fine-tune prep cycle (CI target)
        run: |
          python scripts/run_training_priority_cycle.py \
            --profile llm \
            --target ci \
            --continue-on-error \
            --output-json logs/automation/training_priority/ci_llm_${{ github.run_id }}.json

      - name: Upload training priority artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: training-priority
          path: |
            logs/automation/training_priority/*.json
            data/training/llm_finetune/*.jsonl
