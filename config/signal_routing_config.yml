# Signal Routing Configuration
# Time Series as Default Signal Generator, LLM as Fallback

signal_routing:
  # Primary signal source
  time_series_primary: true  # DEFAULT: true - Time Series is primary

  # Fallback/redundancy
  llm_fallback: false  # Disable LLM fallback to speed up runs
  llm_redundancy: false  # Disable redundancy to avoid latency overhead

  # Time Series model flags
  enable_samossa: true
  enable_sarimax: true
  enable_garch: true
  enable_mssa_rl: true

  # Time Series signal generation thresholds (production defaults)
  time_series:
    confidence_threshold: 0.45  # Slightly lowered for test runs to admit more signals
    min_expected_return: 0.0030 # 30 bps = 2x roundtrip cost buffer (actual ~15 bps roundtrip)
    max_risk_score: 0.85        # Raised to allow higher volatility names during evaluation
    use_volatility_filter: true # Filter signals based on volatility
    # Cost/uncertainty gating for Time Series signals.
    # - default_roundtrip_cost_bps is a *prior* used only when bid/ask or synthetic microstructure
    #   columns (TxnCostBps/ImpactBps) are unavailable. Values are basis points of notional.
    # - min_signal_to_noise is an optional CI-based SNR gate (0 disables).
    cost_model:
      # Phase 7.9: Updated to realistic 2026 execution costs (per risk_mode.yml)
      default_roundtrip_cost_bps:
        US_EQUITY: 1.5   # Updated from 3.2 - modern smart order routing
        INTL_EQUITY: 3.0 # Updated from 6.0 - improved int'l execution
        FX: 1.0          # Updated from 2.0 - tight spreads on majors
        CRYPTO: 8.0      # Updated from 12.0 - CEX improvements
        INDEX: 1.5       # Updated from 2.0 - ETF liquidity
        UNKNOWN: 3.0     # Updated from 5.0 - less conservative default
      min_signal_to_noise: 0.0
    # Production per-ticker overrides (aligned to proposals after review).
    per_ticker:
      "CL=F":
        confidence_threshold: 0.55
        min_expected_return: 0.005
      "MSFT":
        confidence_threshold: 0.45
        min_expected_return: 0.0005
        max_risk_score: 0.85
      "MTN":
        confidence_threshold: 0.45
        min_expected_return: 0.0005
      "AAPL":
        confidence_threshold: 0.50
        min_expected_return: 0.0005

    # Research/diagnostic overrides live in automation scripts via DIAGNOSTIC_MODE/TS_DIAGNOSTIC_MODE=1
    # so production thresholds stay conservative while evidence is gathered.

  # Fallback triggers
  ts_fallback_triggers:
    - forecast_unavailable
    - confidence_below_threshold
    - model_failure
    - insufficient_data

  execution:
    # No-trade windows by asset class (24h clock, inclusive of start, exclusive of end)
    no_trade_windows:
      US_EQUITY: []  # e.g., ["09:30-09:45", "15:50-16:00"]
      FX: []         # e.g., ["16:00-18:00"]
    enhanced_logging:
      include_mid_price: true
      include_route_type: true
      include_fill_timestamp: true

  # Routing mode
  routing_mode: "TIME_SERIES_PRIMARY_LLM_FALLBACK"  # Options:
  # - TIME_SERIES_PRIMARY_LLM_FALLBACK (default)
  # - TIME_SERIES_PRIMARY_LLM_REDUNDANCY
  # - TIME_SERIES_ONLY
  # - LLM_ONLY (legacy mode)
