# Logs Directory Structure

This directory contains all logs generated by the Portfolio Maximizer system, organized by category and phase.

**Last Updated**: 2026-01-25

---

## Directory Structure

```
logs/
├── README.md                    # This file
├── pipeline.log                 # Main pipeline orchestrator log (rotating)
├── pipeline_run.log             # Detailed pipeline execution log (large)
│
├── phase7.5/                    # Phase 7.5: Regime Detection Integration
│   ├── phase7.5_aapl_success.log
│   ├── phase7.5_msft_validation.log
│   ├── phase7.5_nvda_validation.log
│   ├── phase7.5_multi_ticker_validation.log
│   └── phase7.5_multi_ticker_final.log
│
├── phase7.6/                    # Phase 7.6: Threshold Tuning Experiment
│   └── phase7.6_aapl_tuned_thresholds.log
│
├── phase7.7/                    # Phase 7.7: Per-Regime Weight Optimization
│   ├── phase7.7_weight_optimization.log
│   └── phase7.7_validation_aapl.log
│
├── automation/                  # Automated trading loop logs
├── brutal/                      # Comprehensive testing suite logs
├── cron/                        # Scheduled job logs
├── errors/                      # Error-specific logs
├── events/                      # System event logs
├── forecast_audits/             # Forecast audit trail logs
├── forecast_audits_cache/       # Cached audit summaries
├── hyperopt/                    # Hyperparameter optimization logs
├── live_runs/                   # Live trading execution logs
├── performance/                 # Performance profiling logs
├── signals/                     # Signal generation logs
├── stages/                      # Pipeline stage-specific logs
├── warnings/                    # Warning-level logs
└── archive/                     # Old/deprecated logs
```

---

## Phase-Specific Logs

### Phase 7.5: Regime Detection Integration

**Status**: ✅ Complete (2026-01-24 to 2026-01-25)

Logs documenting the integration of regime detection with adaptive ensemble model selection.

| File | Description | Tickers | Size |
|------|-------------|---------|------|
| `phase7.5_aapl_success.log` | Initial AAPL validation with regime detection enabled | AAPL | 82K |
| `phase7.5_msft_validation.log` | MSFT validation (80% HIGH_VOL_TRENDING) | MSFT | 87K |
| `phase7.5_nvda_validation.log` | NVDA validation (extreme volatility, 73% annualized) | NVDA | 87K |
| `phase7.5_multi_ticker_validation.log` | Combined multi-ticker run (concatenated data) | AAPL, MSFT, NVDA | 279K |
| `phase7.5_multi_ticker_final.log` | Final multi-ticker validation (separate pipelines) | AAPL, MSFT, NVDA | 105K |

**Key Findings**:
- RMSE regression: +42% (1.043 → 1.483) due to accuracy-robustness trade-off
- Regime detection working correctly (6 regime types detected)
- Multi-ticker pipeline concatenates data without ticker column (workaround: separate runs)

**Related Documentation**:
- [Documentation/PHASE_7.5_VALIDATION.md](../Documentation/PHASE_7.5_VALIDATION.md)
- [Documentation/PHASE_7.5_MULTI_TICKER_RESULTS.md](../Documentation/PHASE_7.5_MULTI_TICKER_RESULTS.md)

---

### Phase 7.6: Threshold Tuning Experiment

**Status**: ✅ Complete (2026-01-25)

Logs from threshold tuning experiment to address Phase 7.5 RMSE regression.

| File | Description | Tickers | Size |
|------|-------------|---------|------|
| `phase7.6_aapl_tuned_thresholds.log` | AAPL run with adjusted volatility/trend thresholds | AAPL | 87K |

**Key Findings**:
- Threshold tuning had **zero effect** on regime classifications
- RMSE regression confirmed as fundamental trade-off, not calibration issue
- All CRISIS detections were legitimate (51.6% volatility)

**Threshold Changes Tested** (Reverted):
- `vol_threshold_high`: 0.30 → 0.40 (no data in 0.30-0.40 range)
- `trend_threshold_weak`: 0.30 → 0.25 (no impact)

**Related Documentation**:
- [Documentation/PHASE_7.6_THRESHOLD_TUNING.md](../Documentation/PHASE_7.6_THRESHOLD_TUNING.md)

---

### Phase 7.7: Per-Regime Weight Optimization

**Status**: ✅ Core Complete (2026-01-25), Validation In Progress

Logs from per-regime ensemble weight optimization using rolling cross-validation.

| File | Description | Tickers | Size |
|------|-------------|---------|------|
| `phase7.7_weight_optimization.log` | Rolling CV optimization run (10 folds, step_size=20) | AAPL | 35K |
| `phase7.7_validation_aapl.log` | AAPL validation with optimized MODERATE_TRENDING weights | AAPL | 181B |

**Key Findings**:
- **MODERATE_TRENDING**: 65% RMSE reduction (19.26 → 6.74)
- **Optimal weights**: 90% SAMOSSA, 5% SARIMAX, 5% MSSA-RL
- Only 1 regime optimized (CRISIS, MODERATE_MIXED had insufficient samples)

**Related Documentation**:
- [Documentation/PHASE_7.7_WEIGHT_OPTIMIZATION.md](../Documentation/PHASE_7.7_WEIGHT_OPTIMIZATION.md)
- [data/phase7.7_optimized_weights.json](../data/phase7.7_optimized_weights.json)

---

## Core System Logs

### pipeline.log

**Purpose**: Main orchestrator log for ETL pipeline execution

**Rotation**: Rotates when exceeds 10MB (keeps last 5 files)

**Contents**:
- Pipeline initialization and configuration
- Stage transitions (extraction → validation → preprocessing → forecasting → execution)
- Checkpoint saves/resumes
- High-level error summaries

**Size**: ~1.2MB (current)

---

### pipeline_run.log

**Purpose**: Detailed execution log with all model outputs

**Rotation**: No rotation (can grow large)

**Contents**:
- Individual model fitting logs (SARIMAX order selection, SAMOSSA SVD, MSSA-RL RL training)
- Forecast generation details
- Ensemble blending calculations
- Signal routing decisions
- Paper trading executions

**Size**: ~16MB (current)

**Note**: This file can become very large during long runs. Consider archiving old runs periodically.

---

## Specialized Log Directories

### automation/

Logs from `scripts/run_auto_trader.py` (continuous autonomous trading loop).

**Contents**:
- Multi-cycle trading runs
- Real-time signal generation
- Position management
- Risk policy decisions

---

### brutal/

Logs from `bash/comprehensive_brutal_test.sh` (comprehensive testing suite).

**Contents**:
- Synthetic data generation tests
- Multi-ticker validation runs
- Edge case testing (missing data, outliers, extreme volatility)
- Performance benchmarks

---

### forecast_audits/

Forecast audit trail logs (Phase 7.6+ holdout validation system).

**Contents**:
- Per-forecast audit records (ensemble_forecast vs actual)
- Regime-specific accuracy tracking
- Audit accumulation progress (target: 20 audits for production)

**Current Status**: 1/20 audits complete (5% progress)

---

### hyperopt/

Hyperparameter optimization logs from Optuna/hyperopt runs.

**Contents**:
- SARIMAX order search logs
- SAMOSSA window/component optimization
- Ensemble weight tuning (pre-Phase 7.7 manual tuning)

---

### live_runs/

Logs from production-like live trading executions.

**Contents**:
- Real-time data extraction
- Live forecast generation
- Order execution logs
- Position reconciliation

**Note**: Sensitive data (API keys, account info) is NOT logged.

---

### signals/

Signal generation logs (LLM integration, market analysis).

**Contents**:
- LLM-powered signal generation (Ollama integration)
- Fundamental analysis outputs
- Sentiment analysis results
- Signal routing decisions

---

## Log Naming Conventions

### Phase Logs

**Format**: `phase{X.Y}_{ticker}_{description}.log`

**Examples**:
- `phase7.5_aapl_success.log`
- `phase7.7_weight_optimization.log`

### Date-Based Logs

**Format**: `{component}_{YYYY-MM-DD}.log`

**Examples**:
- `automation_2026-01-25.log`
- `live_runs_2026-01-25.log`

### Component Logs

**Format**: `{component}_{descriptor}.log`

**Examples**:
- `pipeline.log`
- `pipeline_run.log`
- `dashboard_bridge.log`

---

## Log Retention Policy

| Category | Retention | Archive Policy |
|----------|-----------|----------------|
| **Phase logs** | Permanent | Keep all (historical analysis) |
| **pipeline.log** | Last 5 rotations | Rotate at 10MB |
| **pipeline_run.log** | Last 30 days | Archive monthly |
| **automation/** | Last 30 days | Delete older |
| **live_runs/** | Last 90 days | Archive quarterly |
| **errors/** | Permanent | Keep all (debugging) |
| **forecast_audits/** | Permanent | Keep all (production validation) |
| **brutal/** | Last 14 days | Delete older |
| **hyperopt/** | Last 90 days | Archive on completion |

---

## Searching Logs

### Find Errors

```bash
# Search all logs for errors
grep -r "ERROR" logs/ | head -20

# Search specific phase
grep "ERROR" logs/phase7.7/*.log

# Search with context
grep -A 5 -B 5 "ERROR" logs/phase7.7/phase7.7_validation_aapl.log
```

### Find Regime Classifications

```bash
# Find all regime detections
grep "REGIME detected" logs/phase7.5/*.log

# Find specific regime
grep "regime=CRISIS" logs/phase7.5/*.log

# Count regime occurrences
grep "regime=" logs/phase7.5/*.log | cut -d'=' -f2 | cut -d',' -f1 | sort | uniq -c
```

### Find Performance Metrics

```bash
# Find RMSE values
grep "RMSE" logs/phase7.7/*.log

# Find optimization results
grep "Optimization complete" logs/phase7.7/*.log

# Find ensemble weights
grep "weights:" logs/phase7.7/*.log
```

### Find Forecast Details

```bash
# Find SARIMAX order selections
grep "Selected order" logs/pipeline_run.log | tail -10

# Find SAMOSSA fit results
grep "SAMOSSA fit complete" logs/pipeline_run.log | tail -10

# Find ensemble forecasts
grep "ENSEMBLE forecast_complete" logs/pipeline_run.log | tail -10
```

---

## Monitoring Active Runs

### Tail Logs in Real-Time

```bash
# Monitor main pipeline
tail -f logs/pipeline.log

# Monitor detailed execution
tail -f logs/pipeline_run.log

# Monitor specific phase validation
tail -f logs/phase7.7/phase7.7_validation_aapl.log
```

### Check Recent Activity

```bash
# Last 50 lines of pipeline log
tail -50 logs/pipeline.log

# Last 100 lines with grep filter
tail -100 logs/pipeline_run.log | grep "REGIME\|RMSE\|ERROR"
```

---

## Troubleshooting

### Log File Not Found

**Issue**: Log file expected but missing

**Causes**:
- Process didn't start (check PID files in `logs/`)
- Incorrect path (check `config/pipeline_config.yml` logging settings)
- Permissions issue (check directory write permissions)

**Solution**:
```bash
# Check if process is running
ps aux | grep python | grep run_etl_pipeline

# Check logging configuration
grep -A 5 "logging:" config/pipeline_config.yml

# Verify write permissions
ls -ld logs/
```

### Log File Too Large

**Issue**: `pipeline_run.log` exceeds 100MB

**Solution**:
```bash
# Archive current log
mv logs/pipeline_run.log logs/archive/pipeline_run_$(date +%Y%m%d).log

# Compress archived log
gzip logs/archive/pipeline_run_*.log

# Create new empty log
touch logs/pipeline_run.log
```

### Missing Phase Logs

**Issue**: Can't find logs for specific phase

**Solution**:
```bash
# Search all logs directory
find logs/ -name "*phase7.5*" -type f

# Check if logs were archived
ls -lh logs/archive/ | grep phase7.5
```

---

## Archive Process

### Manual Archive

```bash
# Archive old pipeline run logs (older than 30 days)
find logs/ -name "pipeline_run.log.*" -mtime +30 -exec mv {} logs/archive/ \;

# Compress archived logs
gzip logs/archive/pipeline_run*.log

# Archive completed phase logs (after validation complete)
tar -czf logs/archive/phase7.5_complete_$(date +%Y%m%d).tar.gz logs/phase7.5/

# Delete very old archives (older than 1 year)
find logs/archive/ -name "*.tar.gz" -mtime +365 -delete
```

### Automated Archive (Recommended)

Add to cron or Windows Task Scheduler:

```bash
# Daily: Archive large pipeline_run.log if > 50MB
bash/archive_large_logs.sh

# Weekly: Compress old logs
bash/compress_old_logs.sh

# Monthly: Archive completed phase logs
bash/archive_phase_logs.sh
```

---

## Integration with Monitoring

### Prometheus/Grafana

Logs can be parsed for metrics:
- RMSE trends over time
- Regime detection frequency
- Model selection distribution
- Forecast audit pass rate

**Log Aggregators**:
- [Promtail](https://grafana.com/docs/loki/latest/clients/promtail/) → Loki → Grafana
- [Filebeat](https://www.elastic.co/beats/filebeat) → Elasticsearch → Kibana

### AlertManager

Configure alerts based on log patterns:
- `ERROR` count exceeds threshold
- RMSE ratio exceeds 2.0
- Pipeline failures
- Forecast audit failures

---

## Best Practices

1. **Always name logs descriptively**: Include phase, ticker, and purpose
2. **Keep phase logs permanent**: Critical for historical analysis
3. **Archive large logs monthly**: Prevent disk space issues
4. **Use grep for quick analysis**: Faster than opening large files
5. **Document key findings**: Add summaries to phase documentation
6. **Compress archived logs**: Save disk space with gzip/tar.gz
7. **Check logs after every run**: Catch errors early
8. **Monitor disk usage**: Set alerts at 80% capacity

---

## Quick Reference

| Task | Command |
|------|---------|
| View recent pipeline activity | `tail -50 logs/pipeline.log` |
| Monitor live run | `tail -f logs/pipeline_run.log` |
| Find all errors | `grep -r "ERROR" logs/` |
| Count regime types | `grep "regime=" logs/phase7.5/*.log \| cut -d'=' -f2 \| cut -d',' -f1 \| sort \| uniq -c` |
| Archive old logs | `bash/archive_large_logs.sh` |
| Check disk usage | `du -sh logs/` |
| Find large logs | `find logs/ -size +10M -ls` |
| Compress log | `gzip logs/archive/old_log.log` |

---

**Maintained By**: Development Team
**Last Review**: 2026-01-25
**Next Review**: 2026-02-01
